<html>

<head>
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=chivo-mono:700" rel="stylesheet" />
    <style>
        body {
            font-family: 'Chivo Mono', monospace;
            background: #000;
            color: hsl(0, 100%, 77%);
            margin: 0;
            padding: 0;
            text-align: center;
            display: flex;
            flex-direction: row;
            align-items: center;


        }


        main {
            width: 100vw;
            height: 100vh;

            display: grid;
            grid-template-columns: 1fr 4fr 1fr;
            grid-template-rows: 1fr 2em 2fr 2em 1fr;
            grid-column-gap: 0px;
            grid-row-gap: 0px;
        }

        .time-container {

            grid-area: 3 / 2 / 4 / 3;
            container-name: time-container;
            container-type: size;
            text-align: center;
        }

        @container time-container (orientation: landscape) {

            .time {

                font-size:41cqw;
                line-height: 100cqh;

            }
        }
        
        @container time-container (orientation: portrait) {
            .time {
                font-size:48cqh;
                line-height: 1em;

                span {
                    display:block;
                }
            }
        }

        .hex {
            font-size: 2em;
            line-height: 1;
            display: inline-block;
        }

        .a {
            grid-area: 2 / 2 / 3 / 3;
        }

        .b {
            grid-area: 4 / 2 / 5 / 3;
        }
    </style>
    <script type="text/javascript" src="/js/clock-toys.js"></script>
</head>

<body>
    <main>

        <span class="hex a"></span>
        <div class="time-container">
            <span class="time">
                <span class="hours">12</span><span class="minutes">40</span>
            </span>
        </div>
        <span class="hex b"></span>

    </main>
    <script>

        // const elTime = document.querySelector('time');
        const elmain = document.querySelector('main');
        const elhexa = document.querySelector('.hex.a');
        const elhexb = document.querySelector('.hex.b');
        const eltime = document.querySelector('.time');
        const elhours = document.querySelector('.hours');
        const elminutes = document.querySelector('.minutes');
        let timer;
        let running = true;

        let colors = {
            a: { H: '', S: '', L: '' },
            b: { H: '', S: '', L: '' }
        }

        const setA = ['a', 'b', 'a', 'b'];
        const setB = ['b', 'a', 'b', 'a'];
        const offsets = [
            -50, 0, 50, 100
        ]

        const popUnshift = () => {
            console.log(stops);
            stops.unshift(stops.pop());
            console.log(stops);
        }


        /**
         * 
         * I'm an idiot - this is excessively complex - I don't need to move the stops, I should fix them, and cycle the colors with an offset
         * 
         * Also - when the sat & lum values flip, it's quite jarring :( can we do a timing / easing function?
         * NB - It's on the hour  that you see the big jump (at least I saw it at 0959 - 1000)
         * 
         * Also - build a clock controller panel to test out different times etc.
         * 
         * Also - change sweepTime to an object for the params, so it can be extended without breaking old clocks
         * 
         * Also - create functionality for timers, long clocks (millenium hand anyone?), alarms, sounds, generative noise etc
         * 
         */


        const tick = (ts) => {
            const time = crudeDate(0);
            const out = timeToOtherThings(time);
            const clockTime = getClockTime();

            colors.a.H = sweepTime(360, clockTime, 'ms', 'm');
            colors.a.S = sweepTime(100, clockTime, 'ms', 'h');
            // colors.a.S = 100;
            colors.a.L = sweepTime(100, clockTime, 'ms', 'd');
            // colors.a.L = 100;

            colors.b.H = (colors.a.H + (360 / 2)) % 360;
            colors.b.S = (colors.a.S + (100 / 2)) % 100;
            colors.b.L = (colors.a.L + (100 / 2)) % 100;

            const pulse = sweepTime(100, clockTime, 'ms', 'm');

            let rings = [];
            let ss = [];

            let stops = pulse >= 50 ? setB : setA;

            stops.forEach((v, i) => {
                let stop = (pulse % 50) + offsets[i];
                rings.push(`hsl(${colors[v].H}, ${colors[v].S}%, ${colors[v].L}%) ${stop}%`);
                ss.push(parseInt(stop));
            })

            const aHex = hslToHex(colors.a.H, colors.a.S, colors.a.L).toUpperCase();
            const bHex = hslToHex(colors.b.H, colors.b.S, colors.b.L).toUpperCase();
            elhexa.setAttribute('style', `color: ${aHex}`); //text-shadow: 0 0 0.2em ${bHex};`)
            elhexa.innerHTML = aHex;
            elhexb.setAttribute('style', `color: ${bHex}`); //text-shadow: 0 0 0.2em ${aHex};`)
            elhexb.innerHTML = bHex;


            const clockface = `background: radial-gradient(circle, ${rings.join(', ')});`;
            elmain.setAttribute('style', clockface);
            
            eltime.setAttribute('style', `color: ${aHex}; text-shadow: 0em 0.1em 0.025em ${bHex};`);
            elhours.innerText = String(clockTime.h).padStart(2, '0');
            elminutes.innerText = String(clockTime.m).padStart(2, '0');
            timer = requestAnimationFrame(tick);
        }

        timer = requestAnimationFrame(tick);
        elmain.addEventListener("dblclick", () => {
            console.log('running', running);
            if (running) {
                cancelAnimationFrame(timer);
                running = false;
            } else {
                timer = requestAnimationFrame(tick);
                running = true;
            }
        });
    </script>
</body>

</html>